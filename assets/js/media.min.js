!function(e,t,a,n){"use strict";var d=t.csk=t.csk||{},i=d.config.currentURL;d.media=d.media||{},d.i18n=d.i18n||{},d.i18n.media=d.i18n.media||{};var s=".media-select-bulk",o=".media-select-cancel",r=".media-select-delete",l={},c=0;d.media=e.extend(d.media,{details:function(n){var i=e(n),s=i.attr("href"),o=(i.data("endpoint"),i.parents(".attachment").data("id")),r=this.previewUrl+"/"+o;if(void 0===r||!r.length)return!1;i.parents(".attachment").addClass("selected");var l=a.getElementById("media-modal-template").innerHTML,c=Handlebars.compile(l);d.ajax.request(r,{type:"POST",data:{action:"media-view_"+o},complete:function(a,n){if("success"!==n)return!1;var d=a.responseJSON;t.history.pushState({href:s},"",s);var i=c(d.results.data);e("#media-modal-container").append(i),e("#media-modal").modal("show")}})},update:function(t){var a=e(t),n=a.attr("action"),i=a.data("id")||"";if(!n.length)return!1;var s={_csknonce:e.trim(a.find("[name=_csknonce]").val()),name:e.trim(a.find("#name").val()),description:e.trim(a.find("#description").val()),action:"update_media_"+i};return d.ajax.request(n,{type:"POST",data:s,complete:function(e,t){if("success"!==t)return!1;a.closest(".modal").modal("hide")}}),!1},delete:function(t){var a=e(t),n=a.data("endpoint"),i=a.data("id");if(void 0===n||!n.length)return!1;d.ui.confirm(d.i18n.media.delete,function(){d.ajax.request(n,{type:"POST",data:{action:"media-delete_"+i},complete:function(t,a){if("success"!==a)return!1;e("#media-modal").modal("hide"),--c<=0?d.ui.reload():e("#media-"+i).fadeOut(function(){e(this).remove()})}})})}}),e(a).ready(function(){i.indexOf("?")>0&&(i=i.substring(0,i.indexOf("?"))),(c=e(".attachments").children(".attachment").length)>0&&e(s).prop("disabled",!1).removeClass("disabled");var n=n||e("#media-modal");n.length&&n.modal("show"),void 0!==e.fn.dropzone&&e("#media-dropzone").dropzone({url:e(this).attr("action"),previewsContainer:".attachments",clickable:"#media-add",params:{action:d.nonce.name,_csknonce:d.nonce.value},init:function(){this.on("addedfile",function(){e(".dz-message").remove()}),this.on("success",function(t,n){var d=n.results||"";if("object"!=typeof d)return!1;var i=a.getElementById("attachment-template").innerHTML,o=Handlebars.compile(i)(d);e(o).hide().prependTo(".attachments").fadeIn("slow"),this.removeFile(t),c<=0&&e(s).prop("disabled",!1).removeClass("disabled"),c++}),this.on("error",function(e,t){d.ui.alert(t.message||t,"error")})}}),e(a).on("hidden.bs.modal","#media-modal",function(a){e(".attachment.selected").removeClass("selected"),t.history.pushState({href:i},"",i),e(this).remove()}),e(a).on("click",s,function(t){e(this).addClass("d-none"),e(o).removeClass("d-none").prop("autofocus",!0),e(r).removeClass("d-none"),e(".attachments").addClass("select-mode")}),e(a).on("click",o,function(t){e(this).addClass("d-none").prop("autofocus",!1),e(r).data("disabled",!0).addClass("d-none disabled"),e(s).removeClass("d-none"),e(".attachments").removeClass("select-mode").children(".attachment").removeClass("selected")}),e(a).on("click",r,function(t){t.preventDefault();var a=e(this);if(!Object.keys(l).length)return a.prop("disabled",!0).addClass("disabled"),!1;d.ui.confirm(d.i18n.media.delete_bulk,function(){var t=e(".attachments").children(".attachment").length;e.each(l,function(a,i){var s=d.media.deleteUrl+"/"+a+"?_csknonce="+i;d.ajax.request(s,{type:"POST",data:{action:"media-delete_"+a},complete:function(i,s){if("success"!==s)return!1;e("#media-"+a).fadeOut(function(){n.length&&n.modal("hide"),e(this).remove()}),--t<=0&&d.ui.reload(null,!1)}})}),a.prop("disabled",!0).addClass("disabled")})}),e(a).on("click",".media-view",function(t){if(t.preventDefault(),e(this).parents(".attachments").hasClass("select-mode")){var a=e(this).parents(".attachment"),n=a.data("id"),i=a.data("nonce");return a.hasClass("selected")?(a.removeClass("selected"),delete l[n],Object.keys(l).length||e(r).prop("disabled",!0).addClass("disabled")):(a.addClass("selected"),l[n]=i,Object.keys(l).length&&e(r).prop("disabled",!1).removeClass("disabled")),!1}return d.media.details(this)}),e(a).on("submit","form.media-update",function(e){return e.preventDefault(),d.media.update(this)}),e(a).on("click",".media-delete",function(e){return e.preventDefault(),d.media.delete(this)})})}(window.jQuery||window.Zepto,window,document);