!function(e,a,t,d){"use strict";var n=a.csk=a.csk||{};n.media=n.media||{},n.i18n=n.i18n||{},n.i18n.media=n.i18n.media||{};var i=".media-select-bulk",s=".media-select-cancel",o=".media-select-delete",l={},r=0;n.media=e.extend(n.media,{details:function(d){var i=e(d),s=i.attr("href"),o=i.parents(".attachment").data("id"),l=this.previewUrl+"/"+o;if(void 0===l||!l.length)return!1;i.parents(".attachment").addClass("selected");var r=t.getElementById("media-modal-template").innerHTML,c=Handlebars.compile(r);n.ajax.request(l,{type:"POST",data:{action:"view_media_"+o},success:function(t,d){if("success"!==d)return!1;a.history.pushState({href:s},"",s);var n=c(t.results.data);e("#media-modal-container").append(n),e("#media-modal").modal("show")}})},update:function(a){var t=e(a),d=t.attr("action"),i=t.data("id")||"";if(!d.length)return!1;var s={_csknonce:e.trim(t.find("[name=_csknonce]").val()),name:e.trim(t.find("#name").val()),description:e.trim(t.find("#description").val()),action:"update_media_"+i};return n.ajax.request(d,{type:"POST",data:s,complete:function(){t.closest(".modal").modal("hide")}}),!1},delete:function(a){var t=e(a),d=t.attr("href"),i=t.data("id");return!!d.length&&n.ui.confirm(n.i18n.media.delete,function(){n.ajax.request(d,{type:"POST",data:{action:"delete_media_"+i},complete:function(){--r<=0?location.reload():e("#media-"+i).fadeOut(function(){e("#media-modal").modal("hide"),e(this).remove()})}})})}}),e(t).ready(function(){lazyload(),(r=e(".attachments").children(".attachment").length)>0&&e(i).prop("disabled",!1).removeClass("disabled");var d=d||e("#media-modal");d.length&&d.modal("show"),void 0!==e.fn.dropzone&&e("#media-dropzone").dropzone({url:e(this).attr("action"),previewsContainer:".attachments",clickable:"#media-add",params:{action:n.nonce.name,_csknonce:n.nonce.value},init:function(){this.on("addedfile",function(){e(".dz-message").remove()}),this.on("success",function(a,d){var n=d.results||"";if("object"!=typeof n)return!1;var s=t.getElementById("attachment-template").innerHTML,o=Handlebars.compile(s)(n);e(o).hide().prependTo(".attachments").fadeIn("slow"),this.removeFile(a),r<=0&&e(i).prop("disabled",!1).removeClass("disabled"),r++}),this.on("error",function(e,a){n.ui.alert(a.message||a,"error")})}}),e(t).on("hidden.bs.modal","#media-modal",function(t){e(".attachment.selected").removeClass("selected");var d=n.config.currentURL;-1!=d.search(/item=/i)&&(d=n.config.adminURL+"/media"),a.history.pushState({href:d},"",d),e(this).remove()}),e(t).on("click",i,function(a){e(this).addClass("hidden"),e(s).removeClass("hidden").prop("autofocus",!0),e(o).removeClass("hidden"),e(".attachments").addClass("select-mode")}),e(t).on("click",s,function(a){e(this).addClass("hidden").prop("autofocus",!1),e(o).data("disabled",!0).addClass("hidden disabled"),e(i).removeClass("hidden"),e(".attachments").removeClass("select-mode").children(".attachment").removeClass("selected")}),e(t).on("click",o,function(t){t.preventDefault();var d=e(this);if(!Object.keys(l).length)return d.prop("disabled",!0).addClass("disabled"),!1;n.ui.confirm(n.i18n.media.delete_bulk,function(){var t=e(".attachments").children(".attachment").length;e.each(l,function(d,i){n.ajax.request(n.media.deleteUrl+"/"+d,{type:"POST",data:{action:"delete_media_"+d,_csknonce:i},complete:function(i,s){e("#media-"+d).fadeOut(function(){e("#media-modal").length&&e("#media-modal").modal("hide"),e(this).remove()}),--t<=0&&(a.location.href=n.config.adminURL+"/media")}})}),d.prop("disabled",!0).addClass("disabled")})}),e(t).on("click",".media-view",function(a){if(a.preventDefault(),e(this).parents(".attachments").hasClass("select-mode")){var t=e(this).parents(".attachment"),d=t.data("id"),i=t.data("nonce");return t.hasClass("selected")?(t.removeClass("selected"),delete l[d],Object.keys(l).length||e(o).prop("disabled",!0).addClass("disabled")):(t.addClass("selected"),l[d]=i,Object.keys(l).length&&e(o).prop("disabled",!1).removeClass("disabled")),!1}return n.media.details(this)}),e(t).on("submit","form.media-update",function(e){return e.preventDefault(),n.media.update(this)}),e(t).on("click",".media-delete",function(e){return e.preventDefault(),n.media.delete(this)})})}(window.jQuery||window.Zepto,window,document);
